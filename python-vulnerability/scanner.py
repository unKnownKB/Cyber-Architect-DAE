import nmap
import socket

def scan_target(target):
    print(f"Scanning {target}...")
    scanner = nmap.PortScanner()
    scanner.scan(target, arguments='-sV')

    scan_results = []
    for host in scanner.all_hosts():
        for proto in scanner[host].all_protocols():
            ports = scanner[host][proto].keys()
            for port in sorted(ports):
                service = scanner[host][proto][port]
                scan_results.append({
                    'port': port,
                    'state': service['state'],
                    'name': service.get('name', ''),
                    'product': service.get('product', ''),
                    'version': service.get('version', '')
                })
    return scan_results

if __name__ == "__main__":
    target_ip = input("Enter target IP address: ")
    results = scan_target(target_ip)
    for r in results:
        print(f"{r['port']} | {r['state']} | {r['name']} | {r['product']} {r['version']}")
